/** @license
 * crossroads <http://millermedeiros.github.com/crossroads.js/>
 * Author: Miller Medeiros | MIT License
 * v0.12.0 (2014/11/18 19:36)
 */
;(function(){var a=function(a){function e(a,b){if(a.indexOf)return a.indexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1}function f(a,b){var c=e(a,b);c!==-1&&a.splice(c,1)}function g(a,b){return"[object "+b+"]"===Object.prototype.toString.call(a)}function h(a){return g(a,"RegExp")}function i(a){return g(a,"Array")}function j(a){return typeof a=="function"}function k(a){var b;return a===null||a==="null"?b=null:a==="true"?b=!0:a==="false"?b=!1:a===d||a==="undefined"?b=d:a===""||isNaN(a)?b=a:b=parseFloat(a),b}function l(a){var b=a.length,c=[];while(b--)c[b]=k(a[b]);return c}function m(a,b){var c=(a||"").replace("?","").split("&"),d=c.length,e={},f,g;while(d--)f=c[d].split("="),g=b?k(f[1]):f[1],e[f[0]]=typeof g=="string"?decodeURIComponent(g):g;return e}function n(b){this.bypassed=new a.Signal,this.routed=new a.Signal,this.routingError=new a.Signal,this.parsingError=new a.Signal,this._name=b||"crossroads router",this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function o(){}function p(b,c,d,e){var f=h(b),g=e.patternLexer;this._router=e,this._pattern=b,this._paramsIds=f?null:g.getParamIds(b),this._optionalParamsIds=f?null:g.getOptionalParamsIds(b),this._matchRegexp=f?b:g.compilePattern(b,e.ignoreCase),this._matchRegexpHead=f?b:g.compilePattern(b,e.ignoreCase,!0),this.matched=new a.Signal,this.switched=new a.Signal;if(c){if(typeof c!="function")throw Error("Route callback must be a function, was:"+typeof c);this.matched.add(c),this._handler=c}this._priority=d||0}var b,c,d;return c=/t(.+)?/.exec("t")[1]==="",n.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(a){return new n(a)},addRoute:function(a,b,c){var d=typeof a=="object"&&a._pattern;if(d)return this.addRoute(a._pattern,a._handler,a._priority);var e=a,f=b;b&&typeof b=="object"&&(console.log("options_or_handler",b),f=b.handler,c=b.priority);var g=new p(e,f,c,this);return this._sortedInsert(g),g},addRoutes:function(a,b){b=b||{reverse:!0};var c=this,d=[];typeof a.getRoutes=="function"&&(d=a.getRoutes());var e=typeof a=="object"&&a.length;if(a instanceof Array||e)d=a;return routesClone=Array.prototype.slice.call(d),d=b.reverse?routesClone.reverse():routesClone,d.forEach(function(a){var b=Object.create(a);c.addRoute(b)}),d},removeRoute:function(a){f(this._routes,a),a._destroy()},removeAllRoutes:function(){var a=this.getNumRoutes();while(a--)this._routes[a]._destroy();this._routes.length=0},getRoutes:function(){return this._routes},getRoutesBy:function(a){a=a||["pattern","priority","greedy","paramsIds","optionalParamsIds"],typeof a=="string"&&(a=[a]),arguments.length>1&&(a=[].slice.call(arguments));var b=this.getRoutes().map(function(b){var c={};return a.forEach(function(a){var d=b["_"+a];!!d&&!(d instanceof Array&&d.length===0)&&(c[a]=d)}),c});return b},getNumRoutes:function(){return this.getRoutes().length},parse:function(a,b){a=a||"",b=b||[];try{return this._attemptParse(a,b)}catch(c){this._logError("Parsing error",c),this.parsingError.dispatch(this.parsingError,b.concat([{request:a,error:c}]))}},_attemptParse:function(a,b){if(!this.ignoreState&&(a===this._prevMatchedRequest||a===this._prevBypassedRequest))return;var c=this._getMatchedRoutes(a),d=0,e=c.length,f;if(e){this._prevMatchedRequest=a,this._switchPrevRoutes(a),this._prevRoutes=c;while(d<e)f=c[d],f.route.matched.dispatch.apply(f.route.matched,b.concat(f.params)),f.isFirst=!d,this.routed.dispatch.apply(this.routed,b.concat([a,f])),d+=1}else this._prevBypassedRequest=a,this.bypassed.dispatch.apply(this.bypassed,b.concat([a]));this._pipeParse(a,b)},_switchPrevRoutes:function(a){var b=0,c;while(c=this._prevRoutes[b++])c.route.switched&&!c.route.active&&c.route.switch(a)},_pipeParse:function(a,b){var c=0,d;while(d=this._piped[c++])d.parse(a,b)},_sortedInsert:function(a){var b=this._routes,c=b.length;do--c;while(b[c]&&a._priority<=b[c]._priority);b.splice(c+1,0,a)},_getMatchedRoutes:function(a){var b=[],c=this._routes,d=c.length,e;while(e=c[--d])e.active=!1;d=c.length;while(e=c[--d])if(!this._matchRoute(a,b,e))break;return b},_matchRoute:function(a,b,c){try{return this._attemptMatchRoute(a,b,c)}catch(d){this._logError("Parsing error",d),this.routingError.dispatch(this.routingError,{request:a,route:c,error:d})}},_attemptMatchRoute:function(a,b,c){if((!b.length||this.greedy||c.greedy)&&c.match(a)){var d=c._getParamsArray(a),e=c._selfAndAncestors(),f=e.length;while(c=e[--f]){var g=c._getParamsArray(a,!0).length,h=d.splice(0,g);if(c.active)continue;c.active=!0,c.activate(a),b.push({route:c,params:h})}}return!this.greedyEnabled&&b.length?!1:!0},pipe:function(a){this._piped.push(a)},unpipe:function(a){f(this._piped,a)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"},_logError:function(a,b){var c=a+": "+b.toString();console.log(c)}},b=new n,b.VERSION="0.12.0",b.NORM_AS_ARRAY=function(a,b){return[b.vals_]},b.NORM_AS_OBJECT=function(a,b){return[b]},o.prototype=Array.prototype,o.prototype.display=function(){return this.map(function(a){return Object.keys(a).map(function(b){return b+": "+a[b]}).join(", ")}).join("\n")},Object.create||(Object.create=function(a){function b(){}return b.prototype=a,new b}),p.prototype={greedy:!1,rules:void 0,match:function(a){return a=a||"",this._matchRegexp.test(a)&&this._validateParams(a)},"switch":function(a){this.willSwitch(a),this.canSwitch(a)||this.cannotSwitch(a)},willSwitch:function(a){},canSwitch:function(a){},cannotSwitch:function(a){},doSwitch:function(a){this.switched.dispatch(a),this.wasSwitched()},wasSwitched:function(a){},activate:function(a){this.willActivate(a),this.canActivate(a)?this.activated(a):this.cannotActivate(a)},willActivate:function(a){},activated:function(a){},canActivate:function(a){},cannotActivate:function(a){},deactivate:function(a){},_validateParams:function(a){var b=this.rules,c=this._getParamsObject(a),d;for(d in b)if(d!=="normalize_"&&b.hasOwnProperty(d)&&!this._isValidParam(a,d,c))return!1;return!0},_isValidParam:function(a,b,c){var d=this.rules[b],f=c[b],g=!1,k=b.indexOf("?")===0;return f==null&&this._optionalParamsIds&&e(this._optionalParamsIds,b)!==-1?g=!0:h(d)?(k&&(f=c[b+"_"]),g=d.test(f)):i(d)?(k&&(f=c[b+"_"]),g=this._isValidArrayRule(d,f)):j(d)&&(g=d(f,a,c)),g},_isValidArrayRule:function(a,b){if(!this._router.ignoreCase)return e(a,b)!==-1;typeof b=="string"&&(b=b.toLowerCase());var c=a.length,d,f;while(c--){d=a[c],f=typeof d=="string"?d.toLowerCase():d;if(f===b)return!0}return!1},_getParamsObject:function(a){var b=this._router.shouldTypecast,d=this._router.patternLexer.getParamValues(a,this._matchRegexpHead,b),f={},g=d.length,h,i;while(g--)i=d[g],this._paramsIds&&(h=this._paramsIds[g],h.indexOf("?")===0&&i&&(f[h+"_"]=i,i=m(i,b),d[g]=i),c&&i===""&&e(this._optionalParamsIds,h)!==-1&&(i=void 0,d[g]=i),f[h]=i),f[g]=i;return f.request_=b?k(a):a,f.vals_=d,f},_getParamsArray:function(a){var b=this.rules?this.rules.normalize_:null,c;return b=b||this._router.normalizeFn,b&&j(b)?c=b(a,this._getParamsObject(a)):c=this._getParamsObject(a).vals_,c},interpolate:function(a){var b=this._router.patternLexer.interpolate(this._pattern,a);if(!this._validateParams(b))throw new Error("Generated string doesn't validate against `Route.rules`.");return b},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"},addRoutes:function(a,b){b=b||{reverse:!0};var c=this,d=[];typeof a.getRoutes=="function"&&(d=a.getRoutes());var e=typeof a=="object"&&a.length;if(a instanceof Array||e)d=a;return routesClone=Array.prototype.slice.call(d),d=b.reverse?routesClone.reverse():routesClone,d.forEach(function(a){var b=Object.create(a);c.addRoute(b)}),d},childRoutes:function(){return this._children||[]},parentRoute:function(){return this._parent},addRoute:function(a,b,c){var d=typeof a=="object"&&a._pattern;if(d)return this.addRoute(a._pattern,a._handler,a._priority);var e=a,f=b;b&&typeof b=="object"&&(f=b.handler,c=b.priority);var g=this._pattern,h;if(!e||typeof e=="function")c=f,f=e,e="";g[g.length-1]==="/"&&(g=g.slice(0,-1)),e[0]!=="/"&&(g+="/"),h=this._router.addRoute(g+e,f,c),h._parent=this,this._children=this._children||[],this._children.push(h);if(!e.length||e==="/")h.greedy=!0;return h},_selfAndAncestors:function(){var a=this,b=[this];while(a=a._parent)b.push(a);return b}},n.prototype.patternLexer=function(){function j(){var a,b;for(a in e)e.hasOwnProperty(a)&&(b=e[a],b.id="__CR_"+a+"__",b.save="save"in b?b.save.replace("{{id}}",b.id):b.id,b.rRestore=new RegExp(b.id,"g"))}function k(a,b){var c=[],d;a.lastIndex=0;while(d=a.exec(b))c.push(d[1]);return c}function m(a){return k(d,a)}function n(a){return k(e.OP.rgx,a)}function o(d,e,j){return d=d||"",d&&(i===f?d=d.replace(b,""):i===h&&(d=d.replace(c,"")),d=p(d,"rgx","save"),d=d.replace(a,"\\$&"),d=p(d,"rRestore","res"),i===f&&(d="\\/?"+d)),i!==g&&(d+="\\/?"),j||(d+="$"),new RegExp("^"+d,e?"i":"")}function p(a,b,c){var d,f;for(f in e)e.hasOwnProperty(f)&&(d=e[f],a=a.replace(d[b],d[c]));return a}function q(a,b,c){var d=b.exec(a);return d&&(d.shift(),c&&(d=l(d))),d}function r(a,b){if(typeof a!="string")throw new Error("Route pattern should be a string.");var c=function(a,c){var d;c=c.substr(0,1)==="?"?c.substr(1):c;if(b[c]!=null){if(typeof b[c]=="object"){var e=[];for(var f in b[c])e.push(encodeURI(f+"="+b[c][f]));d="?"+e.join("&")}else d=String(b[c]);if(a.indexOf("*")===-1&&d.indexOf("/")!==-1)throw new Error('Invalid value "'+d+'" for segment "'+a+'".')}else{if(a.indexOf("{")!==-1)throw new Error("The segment "+a+" is required.");d=""}return d};return e.OS.trail||(e.OS.trail=new RegExp("(?:"+e.OS.id+")+$")),a.replace(e.OS.rgx,e.OS.save).replace(d,c).replace(e.OS.trail,"").replace(e.OS.rRestore,"/")}var a=/[\\.+*?\^$\[\](){}\/'#]/g,b=/^\/|\/$/g,c=/\/$/g,d=/(?:\{|:)([^}:]+)(?:\}|:)/g,e={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},f=1,g=2,h=3,i=f;return j(),{strict:function(){i=g},loose:function(){i=f},legacy:function(){i=h},getParamIds:m,getOptionalParamsIds:n,getParamValues:q,compilePattern:o,interpolate:r}}(),b};typeof define=="function"&&define.amd?define(["signals"],a):typeof module!="undefined"&&module.exports?module.exports=a(require("signals")):window.crossroads=a(window.signals)})();